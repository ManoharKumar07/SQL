CREATE TABLE BOOK (
    BOOK_ID INT PRIMARY KEY,
    TITLE VARCHAR(20),
    PUB_YEAR VARCHAR(20),
    PUBLISHER_NAME VARCHAR(20),
    FOREIGN KEY (PUBLISHER_NAME) REFERENCES PUBLISHER (NAME) ON DELETE CASCADE
);

CREATE TABLE BOOK_AUTHORS (
    AUTHOR_NAME VARCHAR(20),
    BOOK_ID INT,
    PRIMARY KEY (BOOK_ID, AUTHOR_NAME),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE
);

CREATE TABLE PUBLISHER (
    NAME VARCHAR(20) PRIMARY KEY,
    PHONE VARCHAR(20),
    ADDRESS VARCHAR(100)
);

CREATE TABLE BOOK_COPIES (
    NO_OF_COPIES INT,
    BOOK_ID INT,
    PROGRAMME_ID INT,
    PRIMARY KEY (BOOK_ID, PROGRAMME_ID),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (PROGRAMME_ID) REFERENCES LIBRARY_PROGRAMME (PROGRAMME_ID) ON DELETE CASCADE
);

CREATE TABLE BOOK_LENDING (
    DATE_OUT DATE,
    DUE_DATE DATE,
    BOOK_ID INT,
    PROGRAMME_ID INT,
    CARD_NO INT,
    PRIMARY KEY (BOOK_ID, PROGRAMME_ID, CARD_NO),
    FOREIGN KEY (BOOK_ID) REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
    FOREIGN KEY (PROGRAMME_ID) REFERENCES LIBRARY_PROGRAMME (PROGRAMME_ID) ON DELETE CASCADE,
    FOREIGN KEY (CARD_NO) REFERENCES CARD (CARD_NO) ON DELETE CASCADE
);

CREATE TABLE CARD (
    CARD_NO INT PRIMARY KEY
);

CREATE TABLE LIBRARY_PROGRAMME (
    PROGRAMME_ID INT PRIMARY KEY,
    PROGRAMME_NAME VARCHAR(50)
);





DROP TABLE BOOK_LENDING;

DROP TABLE CARD;

DROP TABLE BOOK_COPIES;

DROP TABLE LIBRARY_PROGRAMME;

DROP TABLE BOOK_AUTHORS;

DROP TABLE BOOK;

DROP TABLE PUBLISHER;



INSERT INTO BOOK VALUES (1,'DBMS','JAN-2017', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (2,'ADBMS','JUN-2016','MCGRAW-HILL');
INSERT INTO BOOK VALUES (3, 'CD','SEP-2016','PEARSON');
INSERT INTO BOOK VALUES (4,' ALGORITHMS ','SEP-2015','MIT');
INSERT INTO BOOK VALUES (5,'OS','MAY-2016','PEARSON');
SELECT * FROM BOOK;

INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 1);
INSERT INTO BOOK_AUTHORS VALUES ('NAVATHE', 2);
INSERT INTO BOOK_AUTHORS VALUES ('ULLMAN',3);
INSERT INTO BOOK_AUTHORS VALUES ('CHARLES', 4);
INSERT INTO BOOK_AUTHORS VALUES('GALVIN', 5);
INSERT INTO PUBLISHER VALUES ('MCGRAW-HILL', 9989076587,'BANGALORE');
INSERT INTO PUBLISHER VALUES ('PEARSON', 9889076565,'NEWDELHI');
INSERT INTO PUBLISHER VALUES ('PRENTICE HALL', 7455679345,'HYEDRABAD');
INSERT INTO PUBLISHER VALUES ('WILEY', 8970862340,'CHENNAI');
INSERT INTO PUBLISHER VALUES ('MIT',7756120238,'BANGALORE');
SELECT * FROM PUBLISHER;

INSERT INTO BOOK_COPIES VALUES (10, 1, 10);
INSERT INTO BOOK_COPIES VALUES (5, 1, 11);
INSERT INTO BOOK_COPIES VALUES (2, 2, 12);
INSERT INTO BOOK_COPIES VALUES (5, 2, 13);
INSERT INTO BOOK_COPIES VALUES (7, 3, 14);
INSERT INTO BOOK_COPIES VALUES (1, 5, 10);
INSERT INTO BOOK_COPIES VALUES (3, 4, 11);
INSERT INTO BOOK_LENDING VALUES ('01-JAN-2017', '01-JUN-2017', 1, 10, 101);
INSERT INTO BOOK_LENDING VALUES ('11-JAN-2017', '11-MAR-2017', 3, 14, 101);
INSERT INTO BOOK_LENDING VALUES ('21-FEB-2017', '21-APR-2017', 2, 13, 101);
INSERT INTO BOOK_LENDING VALUES ('15-MAR-2017', '15-JUL-2017', 4, 11, 101);
INSERT INTO BOOK_LENDING VALUES ('12-APR-2017', '12-MAY-2017', 1, 11, 104);


INSERT INTO CARD VALUES (100);
INSERT INTO CARD VALUES (101);
INSERT INTO CARD VALUES (102);
INSERT INTO CARD VALUES (103);
INSERT INTO CARD VALUES (104);
INSERT INTO LIBRARY_PROGRAMME VALUES (10,'VIJAY NAGAR');
INSERT INTO LIBRARY_PROGRAMME VALUES (11,'VIDYANAGAR'); 
INSERT INTO LIBRARY_PROGRAMME VALUES(12,'KUVEMPUNAGAR'); 
INSERT INTO LIBRARY_PROGRAMME VALUES(13,'RAJAJINAGAR');
INSERT INTO LIBRARY_PROGRAMME VALUES (14,'MANIPAL');

SELECT * FROM LIBRARY_PROGRAMME;


SELECT B.BOOK_ID , B.TITLE, B.PUBLISHER_NAME ,A.AUTHOR_NAME,C.NO_OF_COPIES,L.PROGRAMME_ID
FROM BOOK B,BOOK_AUTHORS A,BOOK_COPIES C,LIBRARY_PROGRAMME L
WHERE B.BOOK_ID=A.BOOK_ID AND B.BOOK_ID = C.BOOK_ID AND L.PROGRAMME_ID=C.PROGRAMME_ID;

SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME, C.NO_OF_COPIES, L.PROGRAMME_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_PROGRAMME L
WHERE B.BOOK_ID = A.BOOK_ID
AND B.BOOK_ID = C.BOOK_ID
AND L.PROGRAMME_ID = C.PROGRAMME_ID;

SELECT CARD_NO FROM BOOK_LENDING
WHERE DATE_OUT BETWEEN '01-JAN-2017' AND '01-JUN-2017'
GROUP BY CARD_NO HAVING COUNT(CARD_NO)>3;

DELETE FROM BOOK WHERE BOOK_ID=1;
SELECT * FROM BOOK;

CREATE VIEW  VVIEW AS SELECT B.BOOK_ID ,C.PROGRAMME_ID,C.NO_OF_COPIES FROM BOOK B,BOOK_COPIES C WHERE B.BOOK_ID = C.BOOK_ID;
SELECT * FROM VVIEW;